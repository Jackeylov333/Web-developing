{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{Link}from\"react-router-dom\";import{DragDropContext,Droppable,Draggable}from\"react-beautiful-dnd\";import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const TasksContainer=_ref=>{let{socket}=_ref;const[tasks,setTasks]=useState({});useEffect(()=>{function fetchTasks(){fetch(\"http://localhost:4000/api\").then(res=>res.json()).then(data=>{console.log(data);setTasks(data);});}fetchTasks();},[]);const handleDragEnd=_ref2=>{let{destination,source}=_ref2;if(!destination)return;if(destination.index===source.index&&destination.droppableId===source.droppableId)return;socket.emit(\"taskDragged\",{source,destination});};useEffect(()=>{socket.on(\"tasks\",updatedTasks=>{setTasks(updatedTasks);});socket.on(\"deleteTask\",deletedTaskData=>{setTasks(currentTasks=>{const{taskId,category}=deletedTaskData;const updatedCategoryTasks=currentTasks[category].items.filter(task=>task.id!==taskId);return{...currentTasks,[category]:{...currentTasks[category],items:updatedCategoryTasks}};});});// 清理函数，在组件卸载时取消事件监听\nreturn()=>{socket.off(\"tasks\");socket.off(\"deleteTask\");};},[socket]);const deleteTask=(taskId,category)=>{socket.emit(\"deleteTask\",{taskId,category});};useEffect(()=>{socket.on(\"tasks\",data=>setTasks(data));},[socket]);return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:handleDragEnd,children:Object.entries(tasks).map(task=>/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(task[1].title.toLowerCase(),\"__wrapper\"),children:[/*#__PURE__*/_jsxs(\"h3\",{children:[task[1].title,\" Tasks\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(task[1].title.toLowerCase(),\"__container\"),children:/*#__PURE__*/_jsx(Droppable,{droppableId:task[1].title,children:provided=>/*#__PURE__*/_jsxs(\"div\",{ref:provided.innerRef,...provided.droppableProps,children:[task[1].items.map((item,index)=>/*#__PURE__*/_jsx(Draggable,{draggableId:item.id,index:index,children:provided=>/*#__PURE__*/_jsxs(\"div\",{ref:provided.innerRef,...provided.draggableProps,...provided.dragHandleProps,className:\"\".concat(task[1].title.toLowerCase(),\"__items\"),children:[/*#__PURE__*/_jsx(\"p\",{children:item.title}),/*#__PURE__*/_jsx(\"p\",{className:\"comment\",children:/*#__PURE__*/_jsx(Link,{to:\"/comments/\".concat(task[1].title,\"/\").concat(item.id),children:item.comments.length>0?\"View Comments\":\"Add Comment\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"delete-task-btn\",onClick:()=>deleteTask(item.id,task[1].title),children:\"\\xD7\"})]})},item.id)),provided.placeholder]})})})]},task[1].title))})});};export default TasksContainer;","map":{"version":3,"names":["React","useState","useEffect","Link","DragDropContext","Droppable","Draggable","jsxs","_jsxs","jsx","_jsx","TasksContainer","_ref","socket","tasks","setTasks","fetchTasks","fetch","then","res","json","data","console","log","handleDragEnd","_ref2","destination","source","index","droppableId","emit","on","updatedTasks","deletedTaskData","currentTasks","taskId","category","updatedCategoryTasks","items","filter","task","id","off","deleteTask","className","children","onDragEnd","Object","entries","map","concat","title","toLowerCase","provided","ref","innerRef","droppableProps","item","draggableId","draggableProps","dragHandleProps","to","comments","length","onClick","placeholder"],"sources":["D:/Desktop/src/Web-developing/client/src/components/TasksContainer.js"],"sourcesContent":["import React, {useState, useEffect} from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\r\n\r\nconst TasksContainer = ({ socket }) => {\r\n    const [tasks, setTasks] = useState({});\r\n\r\n    useEffect(() => {\r\n        function fetchTasks() {\r\n            fetch(\"http://localhost:4000/api\")\r\n                .then((res) => res.json())\r\n                .then((data) => {\r\n                    console.log(data);\r\n                    setTasks(data);\r\n                });\r\n        }\r\n        fetchTasks();\r\n    }, []);\r\n\r\n    \r\n\r\n    const handleDragEnd = ({ destination, source }) => {\r\n        if (!destination) return;\r\n        if (\r\n            destination.index === source.index &&\r\n            destination.droppableId === source.droppableId\r\n        )\r\n            return;\r\n    \r\n        socket.emit(\"taskDragged\", {\r\n            source,\r\n            destination,\r\n        });\r\n    };\r\n\r\n    useEffect(() => {\r\n        socket.on(\"tasks\", (updatedTasks) => {\r\n            setTasks(updatedTasks);\r\n        });\r\n\r\n        socket.on(\"deleteTask\", (deletedTaskData) => {\r\n            setTasks((currentTasks) => {\r\n                const { taskId, category } = deletedTaskData;\r\n                const updatedCategoryTasks = currentTasks[category].items.filter(\r\n                    (task) => task.id !== taskId\r\n                );\r\n                return {\r\n                    ...currentTasks,\r\n                    [category]: {\r\n                        ...currentTasks[category],\r\n                        items: updatedCategoryTasks,\r\n                    },\r\n                };\r\n            });\r\n        });\r\n\r\n        // 清理函数，在组件卸载时取消事件监听\r\n        return () => {\r\n            socket.off(\"tasks\");\r\n            socket.off(\"deleteTask\");\r\n        };\r\n    }, [socket]);\r\n\r\n    const deleteTask = (taskId, category) => {\r\n        socket.emit(\"deleteTask\", { taskId, category });\r\n    };\r\n\r\n    useEffect(() => {\r\n        socket.on(\"tasks\", (data) => setTasks(data));\r\n    }, [socket]);\r\n\r\n    return (\r\n        <div className='container'>\r\n            <DragDropContext onDragEnd={handleDragEnd}>\r\n                {Object.entries(tasks).map((task) => (\r\n                    <div\r\n                        className={`${task[1].title.toLowerCase()}__wrapper`}\r\n                        key={task[1].title}\r\n                    >\r\n                        <h3>{task[1].title} Tasks</h3>\r\n                        <div className={`${task[1].title.toLowerCase()}__container`}>\r\n                            <Droppable droppableId={task[1].title}>\r\n                                {(provided) => (\r\n                                    <div ref={provided.innerRef} {...provided.droppableProps}>\r\n                                        {task[1].items.map((item, index) => (\r\n                                            <Draggable\r\n                                                key={item.id}\r\n                                                draggableId={item.id}\r\n                                                index={index}\r\n                                            >\r\n                                                {(provided) => (\r\n                                                    <div\r\n                                                        ref={provided.innerRef}\r\n                                                        {...provided.draggableProps}\r\n                                                        {...provided.dragHandleProps}\r\n                                                        className={`${task[1].title.toLowerCase()}__items`}\r\n                                                    >\r\n                                                        <p>{item.title}</p>\r\n                                                        <p className='comment'>\r\n                                                            <Link to={`/comments/${task[1].title}/${item.id}`}>\r\n                                                                {item.comments.length > 0\r\n                                                                    ? `View Comments`\r\n                                                                    : \"Add Comment\"}\r\n                                                            </Link>\r\n                                                        </p>\r\n                                                        <button\r\n                                                            className='delete-task-btn'\r\n                                                        \r\n                                                            onClick={() => deleteTask(item.id, task[1].title)}\r\n                                                        >\r\n                                                            ×\r\n                                                        </button>\r\n                                                    </div>\r\n                                                )}\r\n                                            </Draggable>\r\n                                        ))}\r\n                                        {provided.placeholder}\r\n                                    </div>\r\n                                )}\r\n                            </Droppable>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </DragDropContext>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default TasksContainer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}